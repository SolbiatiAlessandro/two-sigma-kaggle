n_days = 0
prep_time = 0
prediction_time = 0
n_lag=[3,7,14]
packaging_time = 0
total_market_obs_df = []
for (market_obs_df, news_obs_df, predictions_template_df) in days[:2]:
    n_days +=1
    if (n_days%50==0):
        pass
        #print(n_days,end=' ')
    t = time.time()
    market_obs_df['time'] = market_obs_df['time'].dt.date

    total_market_obs_df.append(market_obs_df)
    if len(total_market_obs_df)==1:
        history_df = total_market_obs_df[0]
    else:
        history_df = pd.concat(total_market_obs_df[-(np.max(n_lag)+1):])
        
    
    confidence = model.predict([history_df, None],verbose=True,normalize=True,normalize_vals=[maxs,mins])      
    confidence = confidence[-len(market_obs_df):] # take only the last day predictions
        
    preds = pd.DataFrame({'assetCode':market_obs_df['assetCode'],'confidence':confidence})
    predictions_template_df = predictions_template_df.merge(preds,how='left').drop('confidenceValue',axis=1).fillna(0).rename(columns={'confidence':'confidenceValue'})
    _COMPARE_PREDICTIONS.append(predictions_template_df)
    packaging_time += time.time() - t